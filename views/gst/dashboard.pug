extends ../layout

block content
    .container-fluid.mt-4
        //- Header
        .row.mb-4
            .col-12
                .d-flex.justify-content-between.align-items-center
                    div
                        h4.mb-1
                            i.bi.bi-file-earmark-text.me-2
                            | GST Returns Management
                        p.text-muted.mb-0 Generate and download GSTR-1 & GSTR-3B returns
                    div
                        if gstConfig
                            span.badge.bg-success.me-2 Configured
                            small.text-muted GSTIN: #{gstConfig.gstin}
                        else
                            a.btn.btn-warning(href='/gst/config')
                                i.bi.bi-gear.me-2
                                | Setup Configuration

        //- Quick Stats
        .row.mb-4
            .col-md-3
                .card.border-primary
                    .card-body.text-center
                        h6.text-muted Current Period
                        h3.mb-0.text-primary= formattedPeriod
                        small.text-muted= currentPeriod
            
            .col-md-3
                .card.border-info
                    .card-body.text-center
                        h6.text-muted Total Returns
                        h3.mb-0.text-info= recentReturns.length
                        small.text-muted Generated
            
            .col-md-3
                .card.border-success
                    .card-body.text-center
                        h6.text-muted GSTIN
                        h3.mb-0.text-success(style='font-size: 1.2rem;')= gstConfig ? gstConfig.gstin : 'Not Set'
                        small.text-muted Location: MUE
            
            .col-md-3
                .card.border-warning
                    .card-body.text-center
                        h6.text-muted Status
                        h3.mb-0.text-warning Manual Filing
                        small.text-muted No API Integration

        //- Main Actions
        .row.mb-4
            .col-md-6
                .card.h-100.border-success
                    .card-header.bg-success.text-white
                        h5.mb-0
                            i.bi.bi-file-text.me-2
                            | GSTR-1
                    .card-body
                        p.text-muted Monthly return of outward supplies (sales)
                        ul.small.mb-3
                            li B2B invoices (Sales to registered dealers)
                            li B2C Large invoices (>₹2.5 lakh)
                            li B2C Small invoices (state-wise summary)
                            li HSN-wise summary of outward supplies
                        
                        if gstConfig
                            a.btn.btn-success.w-100(href='/gst/generate/GSTR1')
                                i.bi.bi-plus-circle.me-2
                                | Generate GSTR-1
                        else
                            button.btn.btn-secondary.w-100(disabled)
                                i.bi.bi-lock.me-2
                                | Setup Configuration First
            
            .col-md-6
                .card.h-100.border-info
                    .card-header.bg-info.text-white
                        h5.mb-0
                            i.bi.bi-file-earmark-text.me-2
                            | GSTR-3B
                    .card-body
                        p.text-muted Monthly summary return and tax payment
                        ul.small.mb-3
                            li Summary of outward supplies
                            li Summary of ITC (Input Tax Credit)
                            li Tax liability calculation
                            li Interest and late fee (if applicable)
                        
                        if gstConfig
                            a.btn.btn-info.w-100(href='/gst/generate/GSTR3B')
                                i.bi.bi-plus-circle.me-2
                                | Generate GSTR-3B
                        else
                            button.btn.btn-secondary.w-100(disabled)
                                i.bi.bi-lock.me-2
                                | Setup Configuration First

        //- Recent Returns
        .row
            .col-12
                .card
                    .card-header.d-flex.justify-content-between.align-items-center
                        h5.mb-0
                            i.bi.bi-clock-history.me-2
                            | Recent Returns
                        a.btn.btn-sm.btn-outline-primary(href='/gst/history') View All
                    
                    .card-body
                        if recentReturns && recentReturns.length > 0
                            .table-responsive
                                table.table.table-hover
                                    thead
                                        tr
                                            th Return Type
                                            th Period
                                            th Generated On
                                            th Status
                                            th Actions
                                    tbody
                                        each ret in recentReturns.slice(0, 5)
                                            tr
                                                td
                                                    span.badge(class=ret.return_type === 'GSTR1' ? 'bg-success' : 'bg-info')= ret.return_type
                                                td= ret.return_period
                                                td= new Date(ret.creation_date).toLocaleDateString('en-IN')
                                                td
                                                    span.badge(class=ret.status === 'READY' ? 'bg-warning' : 'bg-success')= ret.status
                                                td
                                                    a.btn.btn-sm.btn-outline-primary(href=`/gst/return/${ret.return_data_id}`)
                                                        i.bi.bi-eye.me-1
                                                        | View
                        else
                            .text-center.py-5.text-muted
                                i.bi.bi-inbox.display-1
                                p.mt-3 No returns generated yet
                                p.small Generate your first return to get started

        //- How to File Instructions
        .row.mt-4
            .col-12
                .card.border-warning
                    .card-header.bg-warning.text-dark
                        h6.mb-0
                            i.bi.bi-info-circle.me-2
                            | How to File GST Returns (Manual Process)
                    .card-body
                        .row
                            .col-md-6
                                h6 Steps to File:
                                ol.small
                                    li Click "Generate GSTR-1" or "Generate GSTR-3B"
                                    li Preview the data and verify correctness
                                    li Click "Download JSON" to save the file
                                    li Go to 
                                        a(href='https://www.gst.gov.in' target='_blank') GST Portal 
                                        i.bi.bi-box-arrow-up-right.ms-1
                                    li Login with your credentials
                                    li Navigate to Returns → File Returns
                                    li Upload the downloaded JSON file
                                    li Review, sign with DSC/EVC and submit
                            
                            .col-md-6
                                h6 Important Notes:
                                ul.small.text-muted
                                    li Due date for GSTR-1: 11th of next month
                                    li Due date for GSTR-3B: 20th of next month
                                    li Keep downloaded JSON files for your records
                                    li Verify HSN codes before filing
                                    li Check GST amounts match your books