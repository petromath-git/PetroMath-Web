doctype html
html(lang='en')
  head
    meta(charset='UTF-8')
    meta(name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no')
    title Credit Entry · PetroMath
    link(rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css')
    link(rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css')
  body
    style.
        body {
            background: #f0f2f5;
        }

        .dsm-header {
            position: sticky;
            top: 0;
            z-index: 1020;
            background: linear-gradient(135deg, #1a73e8, #0d47a1);
            color: white;
            padding: 12px 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .dsm-header .logout-link {
            font-size: 12px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            padding: 4px 8px;
            border: 1px solid rgba(255,255,255,0.4);
            border-radius: 8px;
            white-space: nowrap;
            margin-top: 2px;
        }

        .dsm-header .logout-link:hover {
            background: rgba(255,255,255,0.15);
            color: white;
            text-decoration: none;
        }

        .dsm-header h5 {
            margin: 0;
            font-size: 17px;
            font-weight: 600;
        }

        .dsm-header .cashier-name {
            font-size: 12px;
            opacity: 0.85;
            margin-top: 2px;
        }

        .dsm-header .shift-badge {
            font-size: 11px;
            background: rgba(255,255,255,0.2);
            padding: 3px 8px;
            border-radius: 12px;
            margin-top: 3px;
            display: inline-block;
        }

        .dsm-container {
            padding: 14px;
            max-width: 480px;
            margin: 0 auto;
        }

        .form-card {
            background: white;
            border-radius: 14px;
            padding: 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 16px;
        }

        .form-card .card-title {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6c757d;
            margin-bottom: 14px;
        }

        .form-label {
            font-size: 13px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }

        .form-control, .form-select {
            font-size: 16px;
            height: 50px;
            border-radius: 10px;
            border: 1.5px solid #dee2e6;
        }

        .form-control:focus, .form-select:focus {
            border-color: #1a73e8;
            box-shadow: 0 0 0 3px rgba(26,115,232,0.15);
        }

        .btn-save {
            width: 100%;
            height: 52px;
            font-size: 17px;
            font-weight: 700;
            border-radius: 12px;
            background: linear-gradient(135deg, #1a73e8, #0d47a1);
            border: none;
            color: white;
            letter-spacing: 0.3px;
        }

        .btn-save:disabled {
            opacity: 0.6;
        }

        .product-btn {
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 10px 14px;
            font-size: 15px;
            font-weight: 600;
            background: white;
            color: #333;
            width: 100%;
            text-align: left;
            margin-bottom: 8px;
            transition: all 0.15s ease;
        }

        .product-btn.selected {
            border-color: #1a73e8;
            background: #e8f0fe;
            color: #1a73e8;
        }

        .product-btn .product-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .dsm-warning {
            background: #fff3cd;
            color: #856404;
            font-size: 13px;
            padding: 10px 16px;
            border-bottom: 1px solid #ffc107;
            line-height: 1.4;
        }

        .no-shift-card {
            background: white;
            border-radius: 14px;
            padding: 36px 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-top: 20px;
        }

        .no-shift-card .icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .entries-section .section-title {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6c757d;
            margin-bottom: 10px;
            padding: 0 2px;
        }

        .entry-card {
            background: white;
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 10px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.07);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .entry-card .entry-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .entry-card .entry-info {
            flex: 1;
            min-width: 0;
        }

        .entry-card .entry-customer {
            font-size: 14px;
            font-weight: 600;
            color: #212529;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .entry-card .entry-meta {
            font-size: 12px;
            color: #6c757d;
            margin-top: 2px;
        }

        .entry-card .entry-shift {
            color: #adb5bd;
            font-size: 11px;
        }

        .entry-card .entry-amount {
            font-size: 15px;
            font-weight: 700;
            color: #1a73e8;
            white-space: nowrap;
        }

        .entry-card .btn-delete {
            background: none;
            border: none;
            color: #dc3545;
            padding: 4px 6px;
            font-size: 16px;
            line-height: 1;
            flex-shrink: 0;
        }

        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            width: 90%;
            max-width: 400px;
        }

        .toast-msg {
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            padding: 12px 18px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        select option:disabled {
            color: #aaa;
        }

        #vehicleGroup {
            transition: opacity 0.2s ease;
        }

        .vehicle-search-wrap {
            position: relative;
        }

        .vehicle-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1.5px solid #1a73e8;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .vehicle-dropdown .vehicle-option {
            padding: 12px 14px;
            font-size: 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .vehicle-dropdown .vehicle-option:last-child {
            border-bottom: none;
        }

        .vehicle-dropdown .vehicle-option:hover,
        .vehicle-dropdown .vehicle-option.highlighted {
            background: #e8f0fe;
            color: #1a73e8;
        }

        .vehicle-dropdown .no-results {
            padding: 12px 14px;
            font-size: 14px;
            color: #6c757d;
        }

        .vehicle-selected-tag {
            margin-top: 8px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #e8f0fe;
            color: #1a73e8;
            font-size: 14px;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 20px;
        }

        .vehicle-selected-tag .clear-vehicle {
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            color: #1a73e8;
            background: none;
            border: none;
            padding: 0;
        }

        .vehicle-input-row {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .vehicle-input-row .form-control {
            flex: 1;
        }

        .btn-scan {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            border: 1.5px solid #dee2e6;
            background: white;
            color: #1a73e8;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .btn-scan:hover {
            background: #e8f0fe;
            border-color: #1a73e8;
        }

        .btn-scan.scanning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        #scanStatus {
            margin-top: 6px;
            font-size: 12px;
            color: #6c757d;
            min-height: 18px;
        }

        #scanStatus.error { color: #dc3545; }
        #scanStatus.success { color: #198754; }

    .dsm-header
        div
            h5 Credit Entry
            .cashier-name #{user.Person_Name}
            if activeClosing
                span.shift-badge Shift ##{activeClosing.closing_id} · Active
        a.logout-link(href='/logout') Logout

    if activeClosing && activeClosing.multipleDrafts
        .dsm-warning
            | ⚠️ You have #{activeClosing.draftCount} open shifts. Entries are going to the latest one (Shift ##{activeClosing.closing_id}). Ask your manager to close the older shifts.
        .dsm-container
            .no-shift-card
                .icon ⏸️
                h6.fw-bold.text-secondary No Active Shift
                p.text-muted.mb-0 You don't have an active shift at this location. Please ask your manager to create a shift for you.

    else
        .dsm-container

            //- Entry Form
            .form-card
                .card-title New Entry

                //- Product selection
                .mb-3
                    label.form-label Product *
                    #productButtons
                        each product in products
                            button.product-btn(
                                type='button'
                                data-product-id=product.product_id
                                data-product-name=product.product_name
                                data-color=product.rgb_color || '#6c757d'
                                data-price=product.price || 0
                            )
                                span.product-dot(style=`background:${product.rgb_color || '#6c757d'}`)
                                | #{product.product_name}

                //- Customer
                .mb-3
                    label.form-label(for='customerSelect') Customer *
                    select#customerSelect.form-control
                        option(value='') Select Customer
                        each credit in credits
                            option(value=credit.creditlist_id) #{credit.Company_Name}

                //- Vehicle smart search
                .mb-3#vehicleGroup(style='opacity:0.4;pointer-events:none')
                    label.form-label Vehicle
                    .vehicle-search-wrap
                        .vehicle-input-row
                            input#vehicleSearch.form-control(
                                type='text'
                                placeholder='Type to search vehicle...'
                                autocomplete='off'
                            )
                            button#btnScanPlate.btn-scan(type='button' title='Scan number plate')
                                i.bi.bi-camera
                        #vehicleDropdown.vehicle-dropdown(style='display:none')
                    input#vehicleId(type='hidden' value='')
                    #vehicleSelected.vehicle-selected-tag(style='display:none')
                    //- Hidden camera input
                    input#cameraInput(type='file' accept='image/*' capture='environment' style='display:none')
                    //- Scan status
                    #scanStatus(style='display:none')

                //- Bill No and Notes
                .input-row.mb-3
                    div
                        label.form-label(for='billNoInput') Bill No
                        input#billNoInput.form-control(
                            type='text'
                            placeholder='Optional'
                            maxlength='50'
                            value='0'
                        )
                    div
                        label.form-label(for='notesInput') Notes
                        input#notesInput.form-control(
                            type='text'
                            placeholder='Optional'
                            maxlength='100'
                        )

                //- Qty and Amount
                .input-row.mb-3
                    div
                        label.form-label(for='qtyInput') Qty (L) *
                        input#qtyInput.form-control(
                            type='number'
                            inputmode='decimal'
                            placeholder='0.00'
                            min='0.001'
                            step='0.001'
                        )
                    div
                        label.form-label(for='amountInput') Amount (₹) *
                        input#amountInput.form-control(
                            type='number'
                            inputmode='decimal'
                            placeholder='0.00'
                            min='0.01'
                            step='0.01'
                        )

                button#btnSave.btn.btn-save(type='button' disabled) Save Entry

            //- Today's entries
            .entries-section
                .section-title Today's Entries
                #entriesList
                    if entries && entries.length > 0
                        each entry in entries
                            .entry-card(data-id=entry.tcredit_id)
                                span.entry-dot(style=`background:${entry.rgb_color || '#6c757d'}`)
                                .entry-info
                                    .entry-customer= entry.Company_Name
                                    .entry-meta
                                        | #{entry.product_name}
                                        if entry.vehicle_number
                                            |  · #{entry.vehicle_number}
                                        |  · #{entry.qty} L
                                        span.entry-shift  · Shift ##{entry.closing_id}
                                .entry-amount ₹#{parseFloat(entry.amount).toLocaleString('en-IN')}
                                button.btn-delete(type='button' data-id=entry.tcredit_id title='Delete') ✕
                    else
                        p.text-muted.text-center.py-3(style='font-size:14px') No entries yet for this shift.

        //- Toast notification
        .toast-container
            #toastMsg.toast-msg(style='display:none')

    script.
        const pageData = !{pageData};

        let selectedProductId = null;
        let selectedProductPrice = 0;

        // Product button selection
        document.querySelectorAll('.product-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.product-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                selectedProductId = this.dataset.productId;
                selectedProductPrice = parseFloat(this.dataset.price) || 0;
                // Recalculate if a value already entered
                const qty = parseFloat(document.getElementById('qtyInput').value);
                const amt = parseFloat(document.getElementById('amountInput').value);
                if (qty > 0 && selectedProductPrice > 0) {
                    document.getElementById('amountInput').value = (qty * selectedProductPrice).toFixed(2);
                } else if (amt > 0 && selectedProductPrice > 0) {
                    document.getElementById('qtyInput').value = (amt / selectedProductPrice).toFixed(3);
                }
                checkFormReady();
            });
        });

        // Customer change — load vehicles into memory for smart search
        const customerSelect = document.getElementById('customerSelect');
        const vehicleGroup = document.getElementById('vehicleGroup');
        const vehicleSearch = document.getElementById('vehicleSearch');
        const vehicleDropdown = document.getElementById('vehicleDropdown');
        const vehicleIdInput = document.getElementById('vehicleId');
        const vehicleSelectedTag = document.getElementById('vehicleSelected');

        let loadedVehicles = []; // all vehicles for selected customer

        customerSelect.addEventListener('change', async function() {
            const creditlistId = this.value;

            // Reset vehicle
            fullResetVehicle();
            vehicleGroup.style.opacity = '0.4';
            vehicleGroup.style.pointerEvents = 'none';

            if (!creditlistId) { checkFormReady(); return; }

            try {
                const resp = await fetch(`/dsm-entry/vehicles/${creditlistId}`);
                const data = await resp.json();
                if (data.success && data.vehicles.length > 0) {
                    loadedVehicles = data.vehicles;
                    vehicleGroup.style.opacity = '1';
                    vehicleGroup.style.pointerEvents = 'auto';
                } else {
                    loadedVehicles = [];
                }
            } catch(e) {
                console.error('Vehicle load error:', e);
                loadedVehicles = [];
            }
            checkFormReady();
        });

        // Smart search — filter loaded vehicles
        vehicleSearch.addEventListener('focus', function() {
            showVehicleDropdown(this.value.trim());
        });

        vehicleSearch.addEventListener('input', function() {
            vehicleIdInput.value = '';
            vehicleSelectedTag.style.display = 'none';
            showVehicleDropdown(this.value.trim());
        });

        function showVehicleDropdown(term) {
            if (!loadedVehicles.length) return;

            const matches = term
                ? loadedVehicles.filter(v =>
                    v.vehicle_number.toLowerCase().includes(term.toLowerCase()) ||
                    (v.vehicle_type && v.vehicle_type.toLowerCase().includes(term.toLowerCase()))
                  )
                : loadedVehicles;

            if (matches.length === 0) {
                vehicleDropdown.innerHTML = '<div class="no-results">No matching vehicles</div>';
            } else {
                vehicleDropdown.innerHTML = matches.map(v => `
                    <div class="vehicle-option" data-id="${v.vehicle_id}" data-number="${v.vehicle_number}">
                        ${v.vehicle_number}${v.vehicle_type ? ' <span style="color:#6c757d;font-size:13px">(' + v.vehicle_type + ')</span>' : ''}
                    </div>
                `).join('');
            }
            vehicleDropdown.style.display = 'block';
        }

        // Select a vehicle from dropdown
        vehicleDropdown.addEventListener('click', function(e) {
            const opt = e.target.closest('.vehicle-option');
            if (!opt) return;
            vehicleIdInput.value = opt.dataset.id;
            vehicleSearch.value = '';
            vehicleDropdown.style.display = 'none';
            vehicleSelectedTag.innerHTML = `${opt.dataset.number} <button class="clear-vehicle" type="button">✕</button>`;
            vehicleSelectedTag.style.display = 'inline-flex';
            checkFormReady();
        });

        // Clear selected vehicle
        vehicleSelectedTag.addEventListener('click', function(e) {
            if (e.target.closest('.clear-vehicle')) {
                resetVehicle();
                vehicleSearch.focus();
                showVehicleDropdown('');
            }
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!vehicleGroup.contains(e.target)) vehicleDropdown.style.display = 'none';
        });

        function resetVehicle() {
            // Clear selection only — keep loadedVehicles intact so search still works
            vehicleIdInput.value = '';
            vehicleSearch.value = '';
            vehicleDropdown.style.display = 'none';
            vehicleSelectedTag.style.display = 'none';
            vehicleSelectedTag.innerHTML = '';
        }

        function fullResetVehicle() {
            // Full reset including loaded data — used when customer changes
            loadedVehicles = [];
            resetVehicle();
        }

        // Number plate scan via camera + Tesseract OCR
        const btnScanPlate = document.getElementById('btnScanPlate');
        const cameraInput  = document.getElementById('cameraInput');
        const scanStatus   = document.getElementById('scanStatus');

        btnScanPlate.addEventListener('click', function() {
            cameraInput.value = ''; // reset so same file can be re-selected
            cameraInput.click();
        });

        cameraInput.addEventListener('change', async function() {
            const file = this.files[0];
            if (!file) return;

            // Show scanning state
            btnScanPlate.classList.add('scanning');
            btnScanPlate.innerHTML = '<i class="bi bi-hourglass-split"></i>';
            showScanStatus('Scanning plate...', '');
            scanStatus.style.display = 'block';

            try {
                const { data: { text } } = await Tesseract.recognize(file, 'eng', {
                    logger: () => {}
                });

                // Clean OCR text — keep only alphanumeric, uppercase
                const cleaned = text.replace(/[^A-Z0-9]/gi, '').toUpperCase();

                // Try to extract Indian number plate pattern (e.g. TN26AC2345)
                const plateMatch = cleaned.match(/[A-Z]{2}\d{1,2}[A-Z]{1,3}\d{1,4}/);
                const result = plateMatch ? plateMatch[0] : cleaned.substring(0, 10);

                if (result.length >= 4) {
                    vehicleSearch.value = result;
                    showVehicleDropdown(result);
                    showScanStatus(`Read: ${result}`, 'success');
                } else {
                    showScanStatus('Could not read plate. Try again.', 'error');
                }

            } catch (err) {
                console.error('OCR error:', err);
                showScanStatus('Scan failed. Type manually.', 'error');
            }

            btnScanPlate.classList.remove('scanning');
            btnScanPlate.innerHTML = '<i class="bi bi-camera"></i>';
        });

        function showScanStatus(msg, type) {
            scanStatus.textContent = msg;
            scanStatus.className = type;
            scanStatus.style.display = 'block';
            if (type === 'success') {
                setTimeout(() => { scanStatus.style.display = 'none'; }, 3000);
            }
        }

        // Form validation — qty OR amount is enough (other auto-calculates)
        function checkFormReady() {
            const qty = parseFloat(document.getElementById('qtyInput').value);
            const amt = parseFloat(document.getElementById('amountInput').value);
            const ready = selectedProductId &&
                          customerSelect.value &&
                          (qty > 0 || amt > 0);
            document.getElementById('btnSave').disabled = !ready;
        }

        // Qty entered — calculate amount
        document.getElementById('qtyInput')?.addEventListener('input', function() {
            const qty = parseFloat(this.value);
            if (qty > 0 && selectedProductPrice > 0) {
                document.getElementById('amountInput').value = (qty * selectedProductPrice).toFixed(2);
            }
            checkFormReady();
        });

        // Amount entered — calculate qty
        document.getElementById('amountInput')?.addEventListener('input', function() {
            const amt = parseFloat(this.value);
            if (amt > 0 && selectedProductPrice > 0) {
                document.getElementById('qtyInput').value = (amt / selectedProductPrice).toFixed(3);
            }
            checkFormReady();
        });

        // Save entry
        document.getElementById('btnSave')?.addEventListener('click', async function() {
            this.disabled = true;
            this.textContent = 'Saving...';

            const body = {
                product_id:    selectedProductId,
                creditlist_id: customerSelect.value,
                vehicle_id:    vehicleIdInput.value || null,
                qty:           document.getElementById('qtyInput').value,
                amount:        document.getElementById('amountInput').value,
                bill_no:       document.getElementById('billNoInput').value.trim() || null,
                notes:         document.getElementById('notesInput').value.trim() || null
            };

            try {
                const resp = await fetch('/dsm-entry', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                const data = await resp.json();

                if (data.success) {
                    showToast('Entry saved!', 'success');
                    resetForm();
                    renderEntries(data.entries);
                } else {
                    showToast(data.message || 'Save failed.', 'danger');
                }
            } catch(e) {
                showToast('Network error. Try again.', 'danger');
            }

            this.textContent = 'Save Entry';
            checkFormReady();
        });

        // Delete entry
        document.getElementById('entriesList')?.addEventListener('click', async function(e) {
            const btn = e.target.closest('.btn-delete');
            if (!btn) return;

            const tcreditId = btn.dataset.id;
            if (!confirm('Delete this entry?')) return;

            btn.disabled = true;

            try {
                const resp = await fetch(`/dsm-entry/${tcreditId}`, { method: 'DELETE' });
                const data = await resp.json();

                if (data.success) {
                    showToast('Entry deleted.', 'success');
                    renderEntries(data.entries);
                } else {
                    showToast(data.message || 'Delete failed.', 'danger');
                    btn.disabled = false;
                }
            } catch(e) {
                showToast('Network error. Try again.', 'danger');
                btn.disabled = false;
            }
        });

        // Render entries list
        function renderEntries(entries) {
            const list = document.getElementById('entriesList');
            if (!entries || entries.length === 0) {
                list.innerHTML = '<p class="text-muted text-center py-3" style="font-size:14px">No entries yet for this shift.</p>';
                return;
            }

            list.innerHTML = entries.map(e => `
                <div class="entry-card" data-id="${e.tcredit_id}">
                    <span class="entry-dot" style="background:${e.rgb_color || '#6c757d'}"></span>
                    <div class="entry-info">
                        <div class="entry-customer">${e.Company_Name}</div>
                        <div class="entry-meta">
                            ${e.product_name}${e.vehicle_number ? ' · ' + e.vehicle_number : ''} · ${parseFloat(e.qty).toFixed(3)} L<span class="entry-shift"> · Shift #${e.closing_id}</span>
                        </div>
                        ${e.bill_no || e.notes ? `<div class="entry-meta">${e.bill_no ? 'Bill: ' + e.bill_no : ''}${e.bill_no && e.notes ? ' · ' : ''}${e.notes ? e.notes : ''}</div>` : ''}
                    </div>
                    <div class="entry-amount">₹${parseFloat(e.amount).toLocaleString('en-IN')}</div>
                    <button class="btn-delete" type="button" data-id="${e.tcredit_id}" title="Delete">✕</button>
                </div>
            `).join('');
        }

        // Reset form after save
        function resetForm() {
            selectedProductId = null;
            selectedProductPrice = 0;
            document.querySelectorAll('.product-btn').forEach(b => b.classList.remove('selected'));
            customerSelect.value = '';
            fullResetVehicle();
            vehicleGroup.style.opacity = '0.4';
            vehicleGroup.style.pointerEvents = 'none';
            document.getElementById('qtyInput').value = '';
            document.getElementById('amountInput').value = '';
            document.getElementById('billNoInput').value = '0';
            document.getElementById('notesInput').value = '';
        }

        // Toast
        function showToast(message, type) {
            const toast = document.getElementById('toastMsg');
            toast.textContent = message;
            toast.style.background = type === 'success' ? '#198754' : '#dc3545';
            toast.style.color = 'white';
            toast.style.display = 'block';
            setTimeout(() => { toast.style.display = 'none'; }, 3000);
        }

    script(src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js')
    script(src='https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js')
    script(src='https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js')